=================================================================================
MCP-LSP Bridge - Integration Test Execution
=================================================================================

Execution Time: 2025-11-11 11:17:49 UTC
Branch: claude/mcp-lsp-bridge-python-refactor-011CV1t4sPKxu2wtcgd8FXV1
Commit: 522c7b66ccb11e02029cc54a5e0a455587ea345f
Triggered by: push

=================================================================================
Test Output:
=================================================================================

Failed to read file /nonexistent/file.py: [Errno 2] No such file or directory: '/nonexistent/file.py'

================================================================================
Python Refactor MCP Server - Integration Tests
================================================================================

[SETUP] Starting MCP server and LSP client...
✓ Server started successfully

================================================================================
TEST 1: Navigation Tools
================================================================================

[Setup] Opening file in LSP...

[1.1] Testing get_definition on 'calculate_total'...
ℹ  No definition found (LSP may still be indexing)

[1.2] Testing get_references for 'calculate_total'...
✓ Found 4 reference(s)
  1. main.py at line 10
  2. main.py at line 46
  3. utils.py at line 9

[1.3] Testing get_hover_info for 'DataProcessor'...
✓ Retrieved hover info: (class) DataProcessor

A class for processing data....

✓ All navigation tool tests completed!

================================================================================
TEST 2: Refactoring Tools
================================================================================

[Setup] Ensuring file is open in LSP...

[2.1] Testing get_code_actions for 'calculate_total' function...
ℹ  No refactoring actions available for this selection

[2.2] Testing rename_symbol to generate WorkspaceEdit plan...
✓ WorkspaceEdit plan generated successfully!
  Document changes: 1
    - main.py: 3 edit(s)

  ℹ  Security Note: WorkspaceEdit generated but NOT applied.
     In production, user must review and approve before applying.

✓ All refactoring tool tests completed!

================================================================================
TEST 3: Cross-File Reference Tracking
================================================================================

[Setup] Opening files in LSP...

[3.1] Testing cross-file references for 'calculate_total'...
✓ Found 4 reference(s) across project
  1. main.py at line 10
  2. main.py at line 46
  3. utils.py at line 9
  4. utils.py at line 16
  ✓ Cross-file reference detected in utils.py

✓ Cross-file reference test completed!

================================================================================
TEST 4: Two-Stage Security Model
================================================================================

[4.1] Verifying rename_symbol does NOT modify files...
✓ File content unchanged after rename_symbol call
  ✓ Security model verified: plan generated without modification

✓ Two-stage security model verified!

================================================================================
TEST 5: WorkspaceEdit Application (P0 - Critical)
================================================================================

[Setup] Creating temporary test file...
  Created test file: /tmp/tmpuw3_ngtb/test_rename.py

[5.1] Generating WorkspaceEdit for rename 'total' → 'sum_value'...
✓ WorkspaceEdit generated
  Generated 3 edit(s)

[5.2] Applying WorkspaceEdit to file system...
✓ apply_workspace_edit succeeded
✓ File content modified
✓ Symbol correctly renamed to 'sum_value'

[5.3] Verifying LSP cache was updated...
✓ LSP found 3 reference(s) to new name

✓ WorkspaceEdit application test passed!

================================================================================
TEST 6: Multi-Line Edit Handling (P1 - High)
================================================================================

[Setup] Creating test files for multi-line scenarios...

[6.1] Testing multi-line function rename...
✓ Multi-line function rename successful

[6.2] Testing line ending preservation...
✓ Line count preserved
✓ Edit applied correctly with line endings preserved

[6.3] Testing empty line handling...
✓ Empty lines preserved
✓ Edit applied correctly with empty lines

✓ Multi-line edit handling test passed!

================================================================================
TEST 7: Error Handling (P2 - Medium)
================================================================================

[7.1] Testing invalid file path handling...
✓ Invalid file path handled gracefully (returned None)

[7.2] Testing out-of-bounds position handling...
✓ Out-of-bounds position handled gracefully

[7.3] Testing invalid WorkspaceEdit handling...
✓ Exception raised for invalid WorkspaceEdit: OSError

[7.4] Testing empty parameter handling...
✓ Empty rename name handled gracefully

[7.5] Testing file permission handling...
✓ Exception raised for readonly file: PermissionError

✓ Error handling test completed!

================================================================================
TEST SUMMARY
================================================================================

Tests passed: 7/7

✓ All tests passed!

[CLEANUP] Shutting down server...
✓ Server shut down successfully

=================================================================================
Test Summary:
=================================================================================
Status: ✅ PASSED
Exit Code: 0

=================================================================================
System Information:
=================================================================================

Python Version: Python 3.11.14
Pyright Version: pyright 1.1.407
Node.js Version: v20.19.5
Runner OS: Linux

=================================================================================
